<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>INKFINITY - Pembayaran</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #ffffff;
      color: #374151;
    }
    .card {
      @apply bg-white rounded-xl shadow p-6 border border-gray-200;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
      <a href="#" class="flex items-center space-x-3">
        <img src="https://storage.googleapis.com/a1aa/image/d7d2308b-3c0c-435d-9ac3-a10a2a93a882.jpg" alt="Logo" class="w-10 h-10">
        <span class="text-2xl font-bold text-gray-900">INKFINITY</span>
      </a>
      <nav class="flex items-center space-x-6 font-semibold text-gray-700">
        <a href="dashboard.html" class="hover:text-blue-600">Dashboard</a>
        <a href="seller-centre.html" class="hover:text-blue-600">Produk</a>
        <a href="pesanan.html" class="hover:text-blue-600">Pesanan</a>
        <a href="pembayaran.html" class="text-blue-600 font-bold">Pembayaran</a>
        <a href="tambah_produk.html" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800">Tambah Produk</a>
      </nav>

      <div class="relative">
        <button id="userMenuBtn" class="flex items-center gap-2">
          <img src="https://storage.googleapis.com/a1aa/image/a34b6437-c38b-4a5a-c7df-453f5500d428.jpg" class="w-10 h-10 rounded-full object-cover">
          <span class="font-semibold text-gray-900 truncate max-w-[120px]">user_inkfinity</span>
          <i class="fas fa-chevron-down text-gray-600"></i>
        </button>
        <!-- Dropdown Menu -->
        <div id="userDropdown" class="hidden absolute right-0 top-[60px] w-48 bg-white rounded-xl shadow-lg py-3 font-semibold text-gray-800">
          <a href="profil-saya.html" class="block px-4 py-2 hover:bg-gray-100">Akun Saya</a>
          <a href="cart.html" class="block px-4 py-2 hover:bg-gray-100">Pesanan Saya</a>
          <button id="logoutBtn" class="w-full text-left px-4 py-2 hover:bg-gray-100">Log Out</button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-12 space-y-16">
    <!-- Riwayat Pembayaran -->
    <section>
      <h2 class="text-2xl font-bold mb-6">Riwayat Pembayaran</h2>
      <div class="overflow-x-auto card">
        <table class="min-w-full text-sm text-left">
          <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
            <tr>
              <th class="px-6 py-3">Tanggal</th>
              <th class="px-6 py-3">ID Pembayaran</th>
              <th class="px-6 py-3">Total</th>
              <th class="px-6 py-3">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100" id="paymentTableBody">
            <!-- Data pembayaran akan dimasukkan di sini -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Ringkasan Pembayaran -->
    <section>
      <h2 class="text-2xl font-bold mb-6">Ringkasan Pembayaran</h2>
      <div class="card space-y-4">
        <div class="flex justify-between">
          <span>Total Pesanan Tertunda</span>
          <span class="font-bold text-gray-900" id="totalPending">Rp 0</span>
        </div>
        <div class="flex justify-between">
          <span>Total Sudah Dibayar</span>
          <span class="font-bold text-green-600" id="totalPaid">Rp 0</span>
        </div>
        <div class="flex justify-between">
          <span>Total Refund</span>
          <span class="font-bold text-red-500" id="totalRefund">Rp 0</span>
        </div>
        <div class="flex justify-between">
          <span>Pendapatan Bulan Ini</span>
          <span class="font-bold text-blue-600" id="monthlyIncome">Rp 0</span>
        </div>
      </div>
    </section>

    <!-- Status Pembayaran Pesanan -->
    <section>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold">Status Pembayaran Pesanan</h2>
        <input type="text" placeholder="Cari ID Pesanan..." class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
      </div>
      <div class="card overflow-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
            <tr>
              <th class="px-4 py-3">ID Pesanan</th>
              <th class="px-4 py-3">Tanggal</th>
              <th class="px-4 py-3">Total</th>
              <th class="px-4 py-3">Status</th>
              <th class="px-4 py-3">Aksi</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100" id="orderStatusTableBody">
            <!-- Data status pesanan akan dimasukkan di sini -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Histori Transaksi -->
    <section>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold">Histori Transaksi</h2>
        <div class="flex gap-2">
          <input type="date" class="border rounded px-3 py-2 text-sm">
          <input type="date" class="border rounded px-3 py-2 text-sm">
          <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">Filter</button>
        </div>
      </div>
      <div class="card overflow-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
            <tr>
              <th class="px-4 py-3">Tanggal</th>
              <th class="px-4 py-3">Deskripsi</th>
              <th class="px-4 py-3">Jumlah</th>
              <th class="px-4 py-3">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100" id="transactionHistoryTableBody">
            <!-- Data histori transaksi akan dimasukkan di sini -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Fitur Tambahan -->
    <section>
      <h2 class="text-2xl font-bold mb-6">Fitur Tambahan</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card text-center">
          <i class="fas fa-file-invoice-dollar text-3xl text-blue-500 mb-2"></i>
          <h3 class="font-semibold text-lg">Unduh Laporan</h3>
          <p class="text-sm text-gray-500 mb-4">Ekspor riwayat transaksi dalam format Excel atau PDF.</p>
          <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">Unduh</button>
        </div>
        <div class="card text-center">
          <i class="fas fa-comment-alt text-3xl text-green-500 mb-2"></i>
          <h3 class="font-semibold text-lg">Pesan Pembeli</h3>
          <p class="text-sm text-gray-500 mb-4">Lihat pesan atau catatan terkait pembayaran dari pembeli.</p>
          <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm">Lihat</button>
        </div>
        <div class="card text-center">
          <i class="fas fa-hand-holding-usd text-3xl text-yellow-500 mb-2"></i>
          <h3 class="font-semibold text-lg">Kelola Refund</h3>
          <p class="text-sm text-gray-500 mb-4">Tinjau dan proses permintaan refund secara efisien.</p>
          <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 text-sm">Kelola</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="text-center py-8 text-sm text-gray-500">
    &copy; 2025 INKFINITY. Semua hak dilindungi.
  </footer>

  <script>
    // Load data pembayaran dari localStorage
    document.addEventListener("DOMContentLoaded", () => {
      const payments = JSON.parse(localStorage.getItem("payments")) || [];
      const paymentTableBody = document.getElementById("paymentTableBody");
      const totalPending = document.getElementById("totalPending");
      const totalPaid = document.getElementById("totalPaid");
      const totalRefund = document.getElementById("totalRefund");
      const monthlyIncome = document.getElementById("monthlyIncome");

      let totalPendingAmount = 0;
      let totalPaidAmount = 0;
      let totalRefundAmount = 0;

      payments.forEach(payment => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="px-6 py-4">${payment.date}</td>
          <td class="px-6 py-4">${payment.paymentId}</td>
          <td class="px-6 py-4">Rp ${payment.total.toLocaleString()}</td>
          <td class="px-6 py-4 text-${getStatusClass(payment.status)} font-semibold">${payment.status}</td>
        `;
        paymentTableBody.appendChild(row);

        // Hitung total berdasarkan status
        if (payment.status === 'Berhasil') {
          totalPaidAmount += payment.total;
        } else if (payment.status === 'Diproses') {
          totalPendingAmount += payment.total;
        } else if (payment.status === 'Gagal') {
          totalRefundAmount += payment.total;
        }
      });

      // Update ringkasan pembayaran
      totalPending.textContent = `Rp ${totalPendingAmount.toLocaleString()}`;
      totalPaid.textContent = `Rp ${totalPaidAmount.toLocaleString()}`;
      totalRefund.textContent = `Rp ${totalRefundAmount.toLocaleString()}`;
      monthlyIncome.textContent = `Rp ${calculateMonthlyIncome(payments).toLocaleString()}`;
    });

    // Fungsi untuk mendapatkan kelas status berdasarkan status pembayaran
    function getStatusClass(status) {
      switch (status) {
        case 'Berhasil':
          return 'text-green-600';
        case 'Diproses':
          return 'text-yellow-500';
        case 'Gagal':
          return 'text-red-500';
        default:
          return 'text-gray-500';
      }
    }

    // Hitung pendapatan bulan ini
    function calculateMonthlyIncome(payments) {
      const currentMonth = new Date().getMonth();
      return payments.reduce((total, payment) => {
        const paymentDate = new Date(payment.date);
        if (paymentDate.getMonth() === currentMonth && payment.status === 'Berhasil') {
          return total + payment.total;
        }
        return total;
      }, 0);
    }
  </script>
</body>
</html>
