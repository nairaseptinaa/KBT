<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tambah Produk - INKFINITY</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #ffffff;
      color: #6b7280;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      margin: 0;
    }
    main {
      flex-grow: 1;
      max-width: 900px;
      margin: 3rem auto 5rem;
      padding: 0 1rem;
      user-select: none;
    }
    header {
      background-color: #fff;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    header .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    header a.logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 800;
      font-size: 1.5rem;
      color: #111827;
      text-decoration: none;
    }
    nav.menu {
      display: flex;
      gap: 1.5rem;
      font-weight: 600;
    }
    nav.menu a, nav.menu button {
      color: #374151;
      cursor: pointer;
      background: none;
      border: none;
      font-size: 1rem;
      transition: color 0.3s ease;
    }
    nav.menu a:hover, nav.menu button:hover {
      color: #2563eb;
      outline: none;
    }
    #userMenuBtn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      background: none;
      border: none;
      position: relative;
      font-weight: 600;
      color: #374151;
      outline: none;
    }
    #userMenuBtn img {
      width: 36px;
      height: 36px;
      border-radius: 9999px;
      object-fit: cover;
    }
    #userDropdown {
      position: absolute;
      top: 48px;
      right: 0;
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgb(0 0 0 / 0.1);
      width: 180px;
      font-weight: 600;
      font-size: 0.9rem;
      color: #111827;
      display: none;
      flex-direction: column;
      z-index: 100;
    }
    #userDropdown a, #userDropdown button {
      padding: 0.75rem 1rem;
      text-align: left;
      background: none;
      border: none;
      cursor: pointer;
      width: 100%;
      color: inherit;
      user-select: none;
    }
    #userDropdown a:hover, #userDropdown button:hover {
      background-color: #f3f4f6;
      outline: none;
    }

    h1.page-title {
      font-size: 3rem;
      font-weight: 800;
      color: #111827;
      margin-bottom: 1rem;
      user-select: none;
    }

    a.back-button {
      display: inline-block;
      margin-bottom: 2rem;
      color: #2563eb;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    a.back-button:hover, a.back-button:focus {
      color: #1e40af;
      outline: none;
    }

    form {
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgb(0 0 0 / 0.05);
      padding: 2.5rem;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #374151;
      user-select: none;
    }
    input[type="text"], input[type="number"], textarea, select {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      color: #111827;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      resize: vertical;
    }
    input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgb(37 99 235 / 0.3);
      outline: none;
    }
    .input-group {
      margin-bottom: 1.75rem;
    }
    button.submit-btn {
      background-color: #111827;
      color: white;
      font-weight: 700;
      padding: 0.75rem 2rem;
      border-radius: 0.5rem;
      font-size: 1.125rem;
      cursor: pointer;
      border: none;
      box-shadow: 0 6px 20px rgb(17 24 39 / 0.25);
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    button.submit-btn:hover, button.submit-btn:focus {
      background-color: #374151;
      outline: none;
      box-shadow: 0 8px 28px rgb(55 65 81 / 0.35);
    }

    #imagePreview {
      max-height: 180px;
      margin-top: 1rem;
      border-radius: 0.75rem;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      object-fit: contain;
      display: none;
      user-select: none;
    }

    section#daftarProduk {
      margin-top: 3rem;
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgb(0 0 0 / 0.05);
      padding: 2rem;
    }
    section#daftarProduk h2 {
      font-size: 2.25rem;
      font-weight: 800;
      margin-bottom: 2rem;
      color: #111827;
      user-select: none;
    }
    .produk-list {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap: 1.5rem;
      max-height: 400px;
      overflow-y: auto;
      padding: 0.25rem;
    }
    .produk-card {
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.05);
      padding: 1.25rem;
      display: flex;
      gap: 1rem;
      cursor: default;
      user-select: text;
      transition: box-shadow 0.3s ease;
    }
    .produk-card:hover {
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.12);
    }
    .produk-img {
      width: 80px;
      height: 80px;
      border-radius: 0.5rem;
      object-fit: cover;
      flex-shrink: 0;
      background-color: #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 0.875rem;
    }
    .produk-info {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 0.25rem;
      color: #374151;
    }
    .produk-info h3 {
      font-weight: 700;
      font-size: 1.125rem;
      color: #111827;
      margin: 0;
    }
    .produk-info p {
      margin: 0;
      font-size: 0.875rem;
      line-height: 1.3;
      color: #6b7280;
    }
    .produk-info .harga {
      font-weight: 700;
      font-size: 1rem;
      color: #2563eb;
    }
    .empty-msg {
      text-align: center;
      font-style: italic;
      color: #9ca3af;
      user-select: none;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <a href="seller-centre.html" class="logo" aria-label="Inkfinity Home">
        <img src="https://storage.googleapis.com/a1aa/image/d7d2308b-3c0c-435d-9ac3-a10a2a93a882.jpg" alt="Inkfinity Logo" width="40" height="40" />
        INKFINITY
      </a>

      <nav class="menu" role="navigation" aria-label="Seller Centre Navigation">
        <button id="dashboardBtn" type="button">Dashboard</button>
        <a href="produk.html">Produk</a>
        <a href="pesanan.html">Pesanan</a>
        <a href="pembayaran.html">Pembayaran</a>
      </nav>

      <button id="userMenuBtn" aria-haspopup="true" aria-expanded="false" type="button" aria-label="User menu" >
        <img src="https://storage.googleapis.com/a1aa/image/a34b6437-c38b-4a5a-c7df-453f5500d428.jpg" alt="User avatar" />
        user_inkfinity
        <svg class="w-4 h-4 ml-0.5 text-gray-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.829l3.71-3.6a.75.75 0 111.04 1.08l-4.25 4.125a.75.75 0 01-1.04 0l-4.25-4.125a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg>
      </button>
      <div id="userDropdown" role="menu" tabindex="-1" >
        <a href="profil-saya.html" role="menuitem">Akun Saya</a>
        <a href="#" role="menuitem">Pesanan Saya</a>
        <button id="logoutBtn" role="menuitem" type="button">Log Out</button>
      </div>
    </div>
  </header>

  <main>
    <h1 class="page-title" id="headingTambahProduk">Tambah Produk Baru</h1>
    
    <a href="dashboard.html" class="back-button" aria-label="Kembali ke Seller Centre">&larr; Kembali ke Seller Centre</a>

    <form id="addProductForm" aria-describedby="formInstructions" novalidate>
      <div class="input-group">
        <label for="productName">Nama Produk <span aria-hidden="true" class="text-red-600">*</span></label>
        <input type="text" id="productName" name="productName" required aria-required="true" placeholder="Misal: Kaos Custom" />
        <p id="productNameError" class="text-red-600 text-sm hidden" role="alert">Nama produk wajib diisi.</p>
      </div>

      <div class="input-group">
        <label for="productDescription">Deskripsi Produk</label>
        <textarea id="productDescription" name="productDescription" rows="4" placeholder="Deskripsi singkat produk (opsional)"></textarea>
      </div>

      <div class="input-group">
        <label for="productPrice">Harga Produk (Rp) <span aria-hidden="true" class="text-red-600">*</span></label>
        <input type="number" id="productPrice" name="productPrice" min="0" required aria-required="true" placeholder="75000" />
        <p id="productPriceError" class="text-red-600 text-sm hidden" role="alert">Harga produk wajib diisi dan tidak boleh kurang dari 0.</p>
      </div>

      <div class="input-group">
        <label for="productCategory">Kategori Produk <span aria-hidden="true" class="text-red-600">*</span></label>
        <select id="productCategory" name="productCategory" required aria-required="true">
          <option value="" disabled selected>Pilih kategori produk</option>
          <option value="kartu-nama">Kartu Nama</option>
          <option value="undangan">Undangan</option>
          <option value="spanduk">Spanduk</option>
          <option value="brosur">Brosur</option>
          <option value="digital-printing">Digital Printing</option>
          <option value="offset-printing">Offset Printing</option>
        </select>
        <p id="productCategoryError" class="text-red-600 text-sm hidden" role="alert">Kategori produk wajib dipilih.</p>
      </div>

      <div class="input-group">
        <label for="productImage">Upload Gambar Produk</label>
        <input type="file" id="productImage" name="productImage" accept="image/*" aria-describedby="imageDescription" />
        <img id="imagePreview" alt="Preview Gambar Produk" />
      </div>

      <div class="input-group">
        <label for="productStock">Stok Produk <span aria-hidden="true" class="text-red-600">*</span></label>
        <input type="number" id="productStock" name="productStock" min="0" required aria-required="true" placeholder="Jumlah stok tersedia" />
        <p id="productStockError" class="text-red-600 text-sm hidden" role="alert">Jumlah stok wajib diisi dan tidak boleh kurang dari 0.</p>
      </div>

      <button type="submit" class="submit-btn" aria-label="Tambah Produk">Tambah Produk</button>
    </form>

    <section id="daftarProduk" aria-labelledby="headingDaftarProduk">
      <h2 id="headingDaftarProduk">Daftar Produk</h2>
      <div class="produk-list" id="productList" role="list" aria-live="polite" aria-relevant="additions removals">
        <!-- Produk akan dirender di sini -->
      </div>
      <p id="emptyMessage" class="empty-msg hidden">Belum ada produk ditambahkan.</p>
    </section>
  </main>

  <script>
    // Toggle dropdown user menu
    const userMenuBtn = document.getElementById('userMenuBtn');
    const userDropdown = document.getElementById('userDropdown');
    userMenuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      userDropdown.style.display = userDropdown.style.display === 'flex' ? 'none' : 'flex';
      userMenuBtn.setAttribute('aria-expanded', userDropdown.style.display === 'flex' ? 'true' : 'false');
    });
    document.addEventListener('click', () => {
      userDropdown.style.display = 'none';
      userMenuBtn.setAttribute('aria-expanded', 'false');
    });

    // Preview upload gambar produk
    const productImageInput = document.getElementById('productImage');
    const imagePreview = document.getElementById('imagePreview');
    productImageInput.addEventListener('change', () => {
      const file = productImageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        imagePreview.src = '';
        imagePreview.style.display = 'none';
      }
    });

    // Ambil produk dari localStorage
    function getProducts() {
      try {
        return JSON.parse(localStorage.getItem('inkfinity-products')) || [];
      } catch {
        return [];
      }
    }
    // Simpan produk ke localStorage
    function saveProducts(products) {
      localStorage.setItem('inkfinity-products', JSON.stringify(products));
    }

    // Render daftar produk
    function renderProductList() {
      const productListEl = document.getElementById('productList');
      const emptyMessageEl = document.getElementById('emptyMessage');
      const products = getProducts();

      productListEl.innerHTML = '';
      if (products.length === 0) {
        emptyMessageEl.classList.remove('hidden');
        return;
      }
      emptyMessageEl.classList.add('hidden');

      products.forEach(product => {
        const article = document.createElement('article');
        article.setAttribute('role', 'listitem');
        article.className = 'produk-card';

        const img = document.createElement('img');
        img.className = 'produk-img';
        if (product.image) {
          img.src = product.image;
          img.alt = product.name;
        } else {
          img.src = 'https://via.placeholder.com/80x80?text=No+Image';
          img.alt = 'No image';
        }
        article.appendChild(img);

        const info = document.createElement('div');
        info.className = 'produk-info';

        const name = document.createElement('h3');
        name.textContent = product.name;
        info.appendChild(name);

        if (product.description) {
          const desc = document.createElement('p');
          desc.textContent = product.description;
          info.appendChild(desc);
        }

        const price = document.createElement('p');
        price.className = 'harga';
        price.textContent = `Rp ${Number(product.price).toLocaleString('id-ID')}`;
        info.appendChild(price);

        if (product.stock !== undefined) {
          const stock = document.createElement('p');
          stock.textContent = `Stok: ${product.stock}`;
          info.appendChild(stock);
        }

        if (product.category) {
          const cat = document.createElement('p');
          cat.textContent = `Kategori: ${product.category}`;
          info.appendChild(cat);
        }

        article.appendChild(info);
        productListEl.appendChild(article);
      });
    }

    // Handle form submit & validation
    const addProductForm = document.getElementById('addProductForm');
    addProductForm.addEventListener('submit', (e) => {
      e.preventDefault();

      // Reset error messages
      ['productNameError', 'productPriceError', 'productCategoryError', 'productStockError'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });

      let isValid = true;

      const nameInput = e.target.productName;
      const priceInput = e.target.productPrice;
      const categoryInput = e.target.productCategory;
      const stockInput = e.target.productStock;

      if (!nameInput.value.trim()) {
        document.getElementById('productNameError').classList.remove('hidden');
        isValid = false;
      }
      if (!priceInput.value || priceInput.value < 0) {
        document.getElementById('productPriceError').classList.remove('hidden');
        isValid = false;
      }
      if (!categoryInput.value) {
        document.getElementById('productCategoryError').classList.remove('hidden');
        isValid = false;
      }
      if (!stockInput.value || stockInput.value < 0 || !Number.isInteger(Number(stockInput.value))) {
        document.getElementById('productStockError').classList.remove('hidden');
        isValid = false;
      }
      if (!isValid) return;

      // Proses simpan data produk sebagai base64 untuk image jika ada
      const newProduct = {
        name: nameInput.value.trim(),
        description: e.target.productDescription.value.trim(),
        price: Number(priceInput.value),
        category: categoryInput.value,
        stock: Number(stockInput.value),
        image: imagePreview.src && imagePreview.style.display !== 'none' ? imagePreview.src : null,
      };

      const products = getProducts();
      products.push(newProduct);
      saveProducts(products);

      alert('Produk berhasil ditambahkan!');

      addProductForm.reset();
      imagePreview.src = '';
      imagePreview.style.display = 'none';

      renderProductList();
    });

    // Navigasi tombol dashboard
    document.getElementById('dashboardBtn').addEventListener('click', () => {
      window.location.href = 'dashboard.html';
    });

    // Inisialisasi render produk saat halaman siap
    document.addEventListener('DOMContentLoaded', () => {
      renderProductList();
    });
  </script>
</body>
</html>

